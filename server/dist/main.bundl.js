!function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=10)}([function(e,r){e.exports=require("graphql")},function(e,r){e.exports=require("graphql-type-datetime")},function(e,r){e.exports=require("bcryptjs")},function(e,r){e.exports=require("email-validator")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("@prisma/client")},function(e,r){e.exports=require("password-validator")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("express-graphql")},function(e,r){e.exports=require("cors")},function(e,r,t){t(11),e.exports=t(12)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,t){"use strict";t.r(r);var n=t(4),a=t.n(n),i=t(0),o=t(1),u=t.n(o),c=t(5),s=t(2),p=t.n(s),l=t(6),h=t.n(l),d=t(3),f=t.n(d),m=t(7),y=t.n(m);function g(e,r,t,n,a,i,o){try{var u=e[i](o),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,a)}function w(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var i=e.apply(r,t);function o(e){g(i,n,a,o,u,"next",e)}function u(e){g(i,n,a,o,u,"throw",e)}o(void 0)}))}}var L=new c.PrismaClient,Q=new h.a;Q.is().min(6).is().max(20).has().not().spaces();var G=new i.GraphQLObjectType({name:"Author",description:"This represents of author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},name:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},favorites:{type:new i.GraphQLList(b),resolve:(t=w(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.favoratiesOnAuthor.findMany({where:{authorId:r.id}});case 2:return t=e.sent,n=t.map((function(e){return e.articleId})),e.next=6,L.article.findMany({where:{id:{in:n}}});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},articles:{type:new i.GraphQLList(b),resolve:(r=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findMany({where:{authorId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},comments:{type:new i.GraphQLList(v),resolve:(e=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.findMany({where:{authorId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r,t}}),b=new i.GraphQLObjectType({name:"Article",description:"This represents a article of the author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},theme:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},content:{type:i.GraphQLString},published:{type:i.GraphQLBoolean},updatedAt:{type:Object(i.GraphQLNonNull)(u.a)},createdAt:{type:Object(i.GraphQLNonNull)(u.a)},image:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},fans:{type:new i.GraphQLList(G),resolve:(t=w(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.favoratiesOnAuthor.findMany({where:{articleId:r.id}});case 2:return t=e.sent,n=t.map((function(e){return e.authorId})),e.next=6,L.author.findMany({where:{id:{in:n}}});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},author:{type:G,resolve:(r=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},comments:{type:new i.GraphQLList(v),resolve:(e=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.findMany({where:{articleId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r,t}}),v=new i.GraphQLObjectType({name:"Comment",description:"This represents a comment of the author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},text:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},createdAt:{type:Object(i.GraphQLNonNull)(u.a)},updatedAt:{type:Object(i.GraphQLNonNull)(u.a)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},article:{type:b,resolve:(r=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findOne({where:{id:r.articleId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},author:{type:G,resolve:(e=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r}}),x=new i.GraphQLObjectType({name:"JWT_USER",description:"Response jwt_token",fields:function(){return{user:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},token:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}}}}),N=new i.GraphQLObjectType({name:"relation",description:"Relation between favor and user",fields:function(){return{authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},author:{type:G,resolve:(r=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},article:{type:b,resolve:(e=w(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findOne({where:{id:r.articleId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r}}),O=new i.GraphQLObjectType({name:"Query",description:"Root Query",fields:function(){return{authors:{type:Object(i.GraphQLList)(G),description:"List of all authors",resolve:(u=w(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.author.findMany();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},articles:{type:Object(i.GraphQLList)(b),description:"List of all articles",args:{limit:{type:Object(i.GraphQLNonNull)(i.GraphQLInt)}},resolve:(o=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findMany({take:t.limit,orderBy:{createdAt:"desc"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return o.apply(this,arguments)})},articlesByAuthor:{type:Object(i.GraphQLList)(b),description:"List with articles from concrete author",args:{authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},limit:{type:Object(i.GraphQLNonNull)(i.GraphQLInt)}},resolve:(a=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findMany({where:{authorId:t.authorId},take:t.limit,orderBy:{createdAt:"desc"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return a.apply(this,arguments)})},comments:{type:Object(i.GraphQLList)(v),description:"List of all comments",resolve:(n=w(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.findMany({orderBy:{createdAt:"desc"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},article:{type:G,description:"Single author",args:{idArticle:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(t=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findOne({where:{id:t.idArticle}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},articlesByCursor:{type:new i.GraphQLList(b),description:"Take articles with pagination",args:{cursor:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},interval:{type:Object(i.GraphQLNonNull)(i.GraphQLInt)}},resolve:(r=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findMany({take:t.interval,skip:1,cursor:{id:t.cursor},orderBy:{createdAt:"desc"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},articlesFromAuthorByCursor:{type:new i.GraphQLList(b),description:"Take articles from concrete author with cursor",args:{authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},cursor:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},interval:{type:Object(i.GraphQLNonNull)(i.GraphQLInt)}},resolve:(e=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.findMany({where:{authorId:t.authorId},take:t.interval,skip:1,cursor:{id:t.cursor},orderBy:{createdAt:"desc"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r,t){return e.apply(this,arguments)})}};var e,r,t,n,a,o,u}}),j=new i.GraphQLObjectType({name:"Mutation",description:"Root Mutations",fields:function(){return{registerUser:{type:G,description:"Register new author",args:{name:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(s=w(regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q.validate(t.password)){e.next=2;break}throw new i.GraphQLError("Password need to have 8 - 20 symbols length, without spaces");case 2:if(f.a.validate(t.email)){e.next=4;break}throw new i.GraphQLError("Email is wrong");case 4:return e.prev=4,e.t0=L.author,e.t1=t.name,e.t2=t.email,e.next=10,p.a.hash(t.password,12);case 10:return e.t3=e.sent,e.t4={name:e.t1,email:e.t2,password:e.t3},e.t5={data:e.t4},e.next=15,e.t0.create.call(e.t0,e.t5);case 15:return n=e.sent,e.abrupt("return",n);case 19:throw e.prev=19,e.t6=e.catch(4),new i.GraphQLError("User with this email already registrated or server can't submit your query");case 22:case"end":return e.stop()}}),e,null,[[4,19]])}))),function(e,r){return s.apply(this,arguments)})},loginUser:{type:x,description:"Login registered user",args:{email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(c=w(regeneratorRuntime.mark((function e(r,t){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==t.email.length){e.next=3;break}throw new i.GraphQLError("You need to enter email");case 3:if(f.a.validate(t.email)){e.next=5;break}throw new i.GraphQLError("Entered wrong email");case 5:if(0!==t.password.length){e.next=7;break}throw new i.GraphQLError("You need to enter your password");case 7:if(Q.validate(t.password)){e.next=9;break}throw new i.GraphQLError("Password need to have 8 - 20 symbols length, without spaces");case 9:return e.next=11,L.author.findOne({where:{email:t.email}});case 11:if(n=e.sent){e.next=14;break}throw new i.GraphQLError("User not found");case 14:return e.next=16,p.a.compare(t.password,n.password);case 16:if(e.sent){e.next=19;break}throw new i.GraphQLError("Wrong password, try again");case 19:return a=y.a.sign({authorId:n.id},"fgbewbwdnsmkvbhjebfgwndfkjlsdnbdf",{expiresIn:"1h"}),e.abrupt("return",{user:n.id,token:a});case 23:throw e.prev=23,e.t0=e.catch(0),new i.GraphQLError("Something goes wrong (".concat(e.t0.message,")"));case 26:case"end":return e.stop()}}),e,null,[[0,23]])}))),function(e,r){return c.apply(this,arguments)})},deleteAuthor:{type:G,description:"Deleting authro",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(u=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.author.delete({where:{id:t.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return u.apply(this,arguments)})},createComment:{type:v,description:"Creating comment",args:{text:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(o=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.create({data:{text:t.text,author:{connect:{id:t.authorId}},article:{connect:{id:t.articleId}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return o.apply(this,arguments)})},createArticle:{type:b,description:"Creating article",args:{theme:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},content:{type:i.GraphQLString},image:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(a=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.article.create({data:{theme:t.theme,content:t.content,image:t.image,author:{connect:{id:t.authorId}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return a.apply(this,arguments)})},deleteComment:{type:v,description:"Deleting comment",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(n=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.delete({where:{id:t.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return n.apply(this,arguments)})},deleteArticle:{type:b,description:"Deleting article",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(t=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.favoratiesOnAuthor.deleteMany({where:{articleId:t.id}});case 2:return e.next=4,L.article.delete({where:{id:t.id}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},updateComment:{type:v,description:"Updating comment",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},newText:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(r=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.comment.update({where:{id:t.id},data:{text:t.newText}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},addFavorite:{type:N,description:"Add article to favorite",args:{idArticle:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},idUser:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(e=w(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.favoratiesOnAuthor.create({data:{article:{connect:{id:t.idArticle}},author:{connect:{id:t.idUser}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r,t){return e.apply(this,arguments)})}};var e,r,t,n,a,o,u,c,s}}),R=new i.GraphQLSchema({query:O,mutation:j}),S=t(8),k=t(9),I=t.n(k),A=a()();A.use(I()()),A.use("/data",Object(S.graphqlHTTP)({schema:R,graphiql:!0})),A.listen("5000",(function(){return console.log("Server started on port ".concat("5000"))}))}]);