!function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=9)}([function(e,r){e.exports=require("graphql")},function(e,r){e.exports=require("bcryptjs")},function(e,r){e.exports=require("email-validator")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("@prisma/client")},function(e,r){e.exports=require("password-validator")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("express-graphql")},function(e,r){e.exports=require("cors")},function(e,r,t){t(10),e.exports=t(11)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,t){"use strict";t.r(r);var n=t(3),a=t.n(n),i=t(0),o=t(4),u=t(1),s=t.n(u),c=t(5),p=t.n(c),h=t(2),l=t.n(h),d=t(6),f=t.n(d);function m(e,r,t,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void t(e)}u.done?r(s):Promise.resolve(s).then(n,a)}function g(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var i=e.apply(r,t);function o(e){m(i,n,a,o,u,"next",e)}function u(e){m(i,n,a,o,u,"throw",e)}o(void 0)}))}}var w=new o.PrismaClient,y=new p.a;y.is().min(6).is().max(20).has().not().spaces();var L=new i.GraphQLObjectType({name:"Author",description:"This represents of author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},name:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},favorites:{type:new i.GraphQLList(b),resolve:(t=g(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.favoratiesOnAuthor.findMany({where:{authorId:r.id}});case 2:return t=e.sent,n=t.map((function(e){return e.articleId})),e.next=6,w.article.findMany({where:{id:{in:n}}});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},articles:{type:new i.GraphQLList(b),resolve:(r=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.findMany({where:{authorId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},comments:{type:new i.GraphQLList(Q),resolve:(e=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.findMany({where:{authorId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r,t}}),b=new i.GraphQLObjectType({name:"Article",description:"This represents a article of the author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},theme:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},content:{type:i.GraphQLString},published:{type:i.GraphQLBoolean},updatedAt:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},image:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},fans:{type:new i.GraphQLList(L),resolve:(t=g(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.favoratiesOnAuthor.findMany({where:{articleId:r.id}});case 2:return t=e.sent,n=t.map((function(e){return e.authorId})),e.next=6,w.author.findMany({where:{id:{in:n}}});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},author:{type:L,resolve:(r=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},comments:{type:new i.GraphQLList(Q),resolve:(e=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.findMany({where:{articleId:r.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r,t}}),Q=new i.GraphQLObjectType({name:"Comment",description:"This represents a comment of the author",fields:function(){return{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},text:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},createdAt:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},updatedAt:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},article:{type:b,resolve:(r=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.findOne({where:{id:r.articleId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},author:{type:L,resolve:(e=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r}}),G=new i.GraphQLObjectType({name:"JWT_USER",description:"Response jwt_token",fields:function(){return{user:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},token:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}}}}),v=new i.GraphQLObjectType({name:"relation",description:"Relation between favor and user",fields:function(){return{authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},author:{type:L,resolve:(r=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.author.findOne({where:{id:r.authorId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},article:{type:b,resolve:(e=g(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.findOne({where:{id:r.articleId}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r){return e.apply(this,arguments)})}};var e,r}}),x=new i.GraphQLObjectType({name:"Query",description:"Root Query",fields:function(){return{authors:{type:Object(i.GraphQLList)(L),description:"List of all authors",resolve:(t=g(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.author.findMany();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},articles:{type:Object(i.GraphQLList)(b),description:"List of all articles",resolve:(r=g(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.findMany();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},comments:{type:Object(i.GraphQLList)(Q),description:"List of all comments",resolve:(e=g(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.findMany();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})}};var e,r,t}}),N=new i.GraphQLObjectType({name:"Mutation",description:"Root Mutations",fields:function(){return{registerUser:{type:L,description:"Register new author",args:{name:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(p=g(regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.validate(t.password)){e.next=2;break}throw new i.GraphQLError("Password need to have 8 - 20 symbols length, without spaces");case 2:if(l.a.validate(t.email)){e.next=4;break}throw new i.GraphQLError("Email is wrong");case 4:return e.prev=4,e.t0=w.author,e.t1=t.name,e.t2=t.email,e.next=10,s.a.hash(t.password,12);case 10:return e.t3=e.sent,e.t4={name:e.t1,email:e.t2,password:e.t3},e.t5={data:e.t4},e.next=15,e.t0.create.call(e.t0,e.t5);case 15:return n=e.sent,e.abrupt("return",n);case 19:throw e.prev=19,e.t6=e.catch(4),new i.GraphQLError("User with this email already registrated or server can't submit your query");case 22:case"end":return e.stop()}}),e,null,[[4,19]])}))),function(e,r){return p.apply(this,arguments)})},loginUser:{type:G,description:"Login registered user",args:{email:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},password:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(c=g(regeneratorRuntime.mark((function e(r,t){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==t.email.length){e.next=3;break}throw new i.GraphQLError("You need to enter email");case 3:if(l.a.validate(t.email)){e.next=5;break}throw new i.GraphQLError("Entered wrong email");case 5:if(0!==t.password.length){e.next=7;break}throw new i.GraphQLError("You need to enter your password");case 7:if(y.validate(t.password)){e.next=9;break}throw new i.GraphQLError("Password need to have 8 - 20 symbols length, without spaces");case 9:return e.next=11,w.author.findOne({where:{email:t.email}});case 11:if(n=e.sent){e.next=14;break}throw new i.GraphQLError("User not found");case 14:return e.next=16,s.a.compare(t.password,n.password);case 16:if(e.sent){e.next=19;break}throw new i.GraphQLError("Wrong password, try again");case 19:return a=f.a.sign({authorId:n.id},"fgbewbwdnsmkvbhjebfgwndfkjlsdnbdf",{expiresIn:"1h"}),e.abrupt("return",{user:n.id,token:a});case 23:throw e.prev=23,e.t0=e.catch(0),new i.GraphQLError("Something goes wrong (".concat(e.t0.message,")"));case 26:case"end":return e.stop()}}),e,null,[[0,23]])}))),function(e,r){return c.apply(this,arguments)})},deleteAuthor:{type:L,description:"Deleting authro",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(u=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.author.delete({where:{id:t.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return u.apply(this,arguments)})},createComment:{type:Q,description:"Creating comment",args:{text:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},articleId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(o=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.create({data:{text:t.text,author:{connect:{id:t.authorId}},article:{connect:{id:t.articleId}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return o.apply(this,arguments)})},createArticle:{type:b,description:"Creating article",args:{theme:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},content:{type:i.GraphQLString},image:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},authorId:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(a=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.create({data:{theme:t.theme,content:t.content,image:t.image,author:{connect:{id:t.authorId}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return a.apply(this,arguments)})},deleteComment:{type:Q,description:"Deleting comment",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(n=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.delete({where:{id:t.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return n.apply(this,arguments)})},deleteArticle:{type:b,description:"Deleting article",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(t=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.article.delete({where:{id:t.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},updateComment:{type:Q,description:"Updating comment",args:{id:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},newText:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(r=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.comment.update({where:{id:t.id},data:{text:t.newText}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},addFavorite:{type:v,description:"Add article to favorite",args:{idArticle:{type:Object(i.GraphQLNonNull)(i.GraphQLString)},idUser:{type:Object(i.GraphQLNonNull)(i.GraphQLString)}},resolve:(e=g(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.favoratiesOnAuthor.create({data:{article:{connect:{id:t.idArticle}},author:{connect:{id:t.idUser}}}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(r,t){return e.apply(this,arguments)})}};var e,r,t,n,a,o,u,c,p}}),O=new i.GraphQLSchema({query:x,mutation:N}),j=t(7),R=t(8),S=t.n(R),k=a()();k.use(S()()),k.use("/data",Object(j.graphqlHTTP)({schema:O,graphiql:!0})),k.listen("5000",(function(){return console.log("Server started on port ".concat("5000"))}))}]);